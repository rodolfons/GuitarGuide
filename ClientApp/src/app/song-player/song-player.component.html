<div style="padding: 20px;">
  <h2>Player de Músicas</h2>

  <div style="margin-bottom: 20px;">
    <h3>Selecione uma Música:</h3>
    <select (change)="selectSong(songs[$any($event.target).value])" style="padding: 10px; width: 100%; max-width: 400px;">
      <option value="">-- Escolha uma música --</option>
      <option *ngFor="let song of songs; let i = index" [value]="i">
        {{ song.name }} <span *ngIf="song.artist">- {{ song.artist }}</span>
      </option>
    </select>
  </div>

  <div *ngIf="selectedSong" style="margin-top: 30px;">
    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
      <h3>{{ selectedSong.name }}</h3>
      <p *ngIf="selectedSong.artist"><strong>Artista:</strong> {{ selectedSong.artist }}</p>
      <p *ngIf="selectedSong.tuning"><strong>Afinação:</strong> {{ selectedSong.tuning }}</p>
      <p *ngIf="selectedSong.tempo"><strong>Tempo:</strong> {{ selectedSong.tempo }} BPM</p>
      <p><strong>Beat Atual:</strong> {{ currentBeat.toFixed(2) }}</p>
    </div>

    <div style="margin-bottom: 20px;">
      <button (click)="play()" [disabled]="isPlaying" 
              style="padding: 10px 20px; margin-right: 10px; background: #28a745; color: white; border: none; cursor: pointer; border-radius: 5px;"
              [style.opacity]="isPlaying ? '0.5' : '1'">
        ▶ Play
      </button>
      <button (click)="pause()" [disabled]="!isPlaying"
              style="padding: 10px 20px; margin-right: 10px; background: #ffc107; color: white; border: none; cursor: pointer; border-radius: 5px;"
              [style.opacity]="!isPlaying ? '0.5' : '1'">
        ⏸ Pause
      </button>
      <button (click)="stop()"
              style="padding: 10px 20px; background: #dc3545; color: white; border: none; cursor: pointer; border-radius: 5px;">
        ⏹ Stop
      </button>
    </div>

    <!-- Timeline Visual -->
    <div class="timeline-container">
      <h4 style="color: white;">Timeline:</h4>
      
      <!-- Fixed vertical line indicator -->
      <div class="current-position-line"></div>
      
      <!-- String labels (fixed on left) -->
      <div class="string-labels">
        <div *ngFor="let string of ['E','B','G','D','A','E']; let i = index" 
             class="string-label"
             [style.top.px]="50 + i * 40">
          {{ string }}
        </div>
      </div>
      
      <!-- Scrollable tablature -->
      <div class="timeline-scroll">
        <svg [attr.width]="getTotalBeats() * 80 + 100" height="300" 
             [style.transform]="'translateX(' + getScrollOffset() + 'px)'">
          <!-- Strings (6 horizontal lines) for notes -->
          <g *ngFor="let string of [0,1,2,3,4,5]; let stringIndex = index">
            <line [attr.x1]="50" 
                  [attr.y1]="50 + stringIndex * 40" 
                  [attr.x2]="getTotalBeats() * 80 + 50" 
                  [attr.y2]="50 + stringIndex * 40" 
                  stroke="#444" 
                  stroke-width="2"/>
          </g>

        <!-- Musical Elements -->
        <g *ngFor="let elem of musicalElements">
          <!-- Chord -->
          <g *ngIf="elem.type === 'chord'">
            <!-- Chord positions on strings -->
            <g *ngFor="let pos of getChordPositions(elem.chordId!); let stringIndex = index">
              <!-- Fret numbers (including 0) -->
              <circle *ngIf="pos !== 'x' && pos !== 'X'"
                      [attr.cx]="50 + elem.beat * 80 + 20" 
                      [attr.cy]="50 + stringIndex * 40"
                      [attr.r]="12"
                      fill="#FFA500"
                      opacity="0.9"/>
              <text *ngIf="pos !== 'x' && pos !== 'X'"
                    [attr.x]="50 + elem.beat * 80 + 20" 
                    [attr.y]="50 + stringIndex * 40 + 5" 
                    fill="#000" 
                    font-size="16" 
                    font-weight="bold"
                    text-anchor="middle">
                {{ pos }}
              </text>
            </g>
          </g>

          <!-- Note -->
          <g *ngIf="elem.type === 'note'">
            <circle [attr.cx]="50 + (elem.beat + elem.duration/2) * 80" 
                    [attr.cy]="50 + elem.string! * 40" 
                    [attr.r]="12"
                    fill="#FFA500"
                    opacity="0.9"/>
            <text [attr.x]="50 + (elem.beat + elem.duration/2) * 80" 
                  [attr.y]="50 + elem.string! * 40 + 5" 
                  fill="#000" 
                  font-size="16" 
                  font-weight="bold"
                  text-anchor="middle">
              {{ elem.noteFret }}
            </text>
          </g>

          <!-- Tab (6 strings at once) -->
          <g *ngIf="elem.type === 'tab'">
            <!-- Tab positions on all 6 strings -->
            <g *ngFor="let pos of parseTabPositions(elem.tabPositions!); let stringIndex = index">
              <!-- Fret numbers (including 0) -->
              <circle *ngIf="pos !== 'x' && pos !== 'X'"
                      [attr.cx]="50 + elem.beat * 80 + 20" 
                      [attr.cy]="50 + stringIndex * 40"
                      [attr.r]="12"
                      fill="#FFA500"
                      opacity="0.9"/>
              <text *ngIf="pos !== 'x' && pos !== 'X'"
                    [attr.x]="50 + elem.beat * 80 + 20" 
                    [attr.y]="50 + stringIndex * 40 + 5" 
                    fill="#000" 
                    font-size="16" 
                    font-weight="bold"
                    text-anchor="middle">
                {{ pos }}
              </text>
            </g>
          </g>
        </g>
        </svg>
      </div>
    </div>
  </div>
</div>
